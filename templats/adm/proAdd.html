{% extends 'adm/base.html' %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.11/cropper.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.11/cropper.js"></script>

<div class="pd-ltr-20 xs-pd-20-10">
	<div class="min-height-200px">
		<!-- Default Basic Forms Start -->
		<div class="pd-20 card-box mb-30">
			<div class="clearfix">
				<div class="pull-left">
					<h4 class="text-blue h4">Add Product</h4>
				</div>
			</div>

			{% for message in messages %}
			<h6 style="color: red;">{{ message }}</h6>
			{% endfor %}

			<!-- ######################## -->

			<main role="main" class="container" style="padding-top: 10px;">
				<div class="row">



					<form method="POST" enctype="multipart/form-data" id="submit-form">
						{% csrf_token %}

						<div class="form-group row">
							<label class="col-sm-12 col-md-2 col-form-label">Brand</label>
							<div class="col-sm-12 col-md-10" style="color: red;">
								<input class="form-control" type="text" id="brand" name="brand"
									placeholder="brand name">
							</div>
						</div>
						<div class="form-group row">
							<label class="col-sm-12 col-md-2 col-form-label">Prodect Name</label>
							<div class="col-sm-12 col-md-10" style="color: red;">
								<input class="form-control" placeholder="Prodect name" id="prodectname"
									name="prodectname" type="text">
							</div>
						</div>
						<div class="form-group row">
							<label class="col-sm-12 col-md-2 col-form-label">Model_No</label>
							<div class="col-sm-12 col-md-10" style="color: red;">
								<input class="form-control" placeholder="model number" id="model_no" name="model_no"
									type="text">
							</div>
						</div>
						<div class="form-group row">
							<label class="col-sm-12 col-md-2 col-form-label">Gender Catagory</label>
							<div class="col-sm-12 col-md-10" style="color: red;">
								<select class="custom-select col-12" id="gender" name="gender">
									<option value="Men">Men</option>
									<option value="Women">Women</option>
								</select>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-sm-12 col-md-2 col-form-label">Catagory</label>
							<div class="col-sm-12 col-md-10" style="color: red;">
								<select class="custom-select col-12" id="catagory" name="catagory">
									{% for cat in links %}
									<option value="{{cat.id}}">{{cat.cat_name}}</option>
									{% endfor %}
								</select>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-sm-12 col-md-2 col-form-label">Price</label>
							<div class="col-sm-12 col-md-10" style="color: red;">
								<input class="form-control" placeholder="price" id="price" name="price" min="1"
									type="number">
							</div>
						</div>
						<div class="form-group row">
							<label class="col-sm-12 col-md-2 col-form-label">Stock</label>
							<div class="col-sm-12 col-md-10" style="color: red;">
								<input class="form-control" placeholder="Stock" id="stock" name="stock" type="number">
							</div>
						</div>
						<div class="form-group row">
							<label class="col-sm-12 col-md-2 col-form-label">Features</label>
							<div class="col-sm-12 col-md-10" style="color: red;">
								<textarea style="width: 100%;" class="form-control" name="discription" id="discription"
									cols="30" placeholder="features" rows="10"></textarea>
							</div>
						</div>

						<div class=" row ">
							<label class="col-sm-12 col-md-2 col-form-label ">Image</label>

							<div class="col-sm-12 col-md-3 d-flex justify-content-center" style="color: red;">
								<!-- <label for="img1"><img src="{% static 'user/images/download.png' %}" alt=""></label> -->
								<input class="form-control" placeholder="image 1" name="img1" id="img1" accept="image/*"
									type="file">
							</div>
							<div class="col-sm-12 col-md-3 d-flex justify-content-center" style="color: red;">
								<!-- <label for="img2"><img src="{% static 'user/images/download.png' %}" alt=""></label> -->
								<input class="form-control" placeholder="image 2" name="img2" id="img2" accept="image/*"
									type="file">
							</div>
							<div class="col-sm-12 col-md-3 d-flex justify-content-center" style="color: red;">
								<!-- <label for="img3"><img src="{% static 'user/images/download.png' %}" alt=""></label> -->
								<input class="form-control" placeholder="image 3" name="img3" id="img3" accept="image/*"
									type="file" required>
							</div>
						</div><br>

						<div class="row">
							<div class="col-md-3">
								<hr>
							</div>
							<div class="col-md-6">



								<div class="form-group">
									<div id="image-box" class="image-container"></div>
									<button class="btn btn-outline-info" id="crop-btn"
										style="width: 100%; margin-top: 10px; display: none;"
										type="button">Crop</button>
									<button class="btn btn-outline-info" id="confirm-btn"
										style="width: 100%; margin-top: 10px;" type="submit">Submit</button>
								</div>
								<div class="container">
									<div class="row" >
										<div class="col-md-1"></div>
										<img src="" id="image1" style="height: 30%; width: 30%;" alt="Image 1">
										<img src="" id="image2" style="height: 30%; width: 30%;" alt="Image 2">
										<img src="" id="image3" style="height: 30%; width: 30%;" alt="Image 3">

									</div>
								</div>

							</div>
							<div class="col-md-3">
								<hr>
							</div>

						</div>
					</form>



				</div>

			</main>
		</div>



		<script>

			//1st crop

			// image-box is the id of the div element that will store our cropping image preview
			const imagebox = document.getElementById('image-box')
			// crop-btn is the id of button that will trigger the event of change original file with cropped file.
			const crop_btn = document.getElementById('crop-btn')
			// id_image is the id of the input tag where we will upload the image
			const input = document.getElementById('img1')
			var allowedExtensions =
				/(\.jpg|\.jpeg|\.png|\.webp)$/i;

			var filePath = input.value;

			// When user uploads the image this event will get triggered
			input.addEventListener('change', () => {
				if (!allowedExtensions.exec(input.value)) {
					alert('Invalid file type');
					input.value = '';
				}
				else {
					// Getting image file object from the input variable
					const img_data = input.files[0]
					// createObjectURL() static method creates a DOMString containing a URL representing the object given in the parameter.
					// The new object URL represents the specified File object or Blob object.
					const url = URL.createObjectURL(img_data)

					// Creating a image tag inside imagebox which will hold the cropping view image(uploaded file) to it using the url created before.
					imagebox.innerHTML = `<img src="${url}" id="image" style="width:500px;">`

					// Storing that cropping view image in a variable
					const image = document.getElementById('image')

					// Displaying the image box
					document.getElementById('image-box').style.display = 'block'
					// Displaying the Crop buttton
					document.getElementById('crop-btn').style.display = 'block'
					// Hiding the Post button
					document.getElementById('confirm-btn').style.display = 'none'

					// Creating a croper object with the cropping view image
					// The new Cropper() method will do all the magic and diplay the cropping view and adding cropping functionality on the website
					// For more settings, check out their official documentation at https://github.com/fengyuanchen/cropperjs
					const cropper = new Cropper(image, {
						autoCropArea: 1,
						viewMode: 1,
						scalable: false,
						zoomable: false,
						movable: false,
						aspectRatio: 25 / 25,
						//preview: '.preview',
						minCropBoxWidth: 200,
						minCropBoxHeight: 200,
					})

					// When crop button is clicked this event will get triggered
					crop_btn.addEventListener('click', () => {
						// This method coverts the selected cropped image on the cropper canvas into a blob object
						cropper.getCroppedCanvas().toBlob((blob) => {

							// Gets the original image data
							let fileInputElement = document.getElementById('img1');
							// Make a new cropped image file using that blob object, image_data.name will make the new file name same as original image
							let file = new File([blob], img_data.name, { type: "image/*", lastModified: new Date().getTime() });
							// Create a new container
							let container = new DataTransfer();
							// Add the cropped image file to the container
							container.items.add(file);
							// Replace the original image file with the new cropped image file
							fileInputElement.files = container.files;
							console.log(container.files[0])
							let img = container.files[0]
							const url = URL.createObjectURL(img)
							document.getElementById('image1').src = url

							// Hide the cropper box
							document.getElementById('image-box').style.display = 'none'
							// Hide the crop button
							document.getElementById('crop-btn').style.display = 'none'
							// Display the Post button
							document.getElementById('confirm-btn').style.display = 'block'

						});

					});
				}
			});
			//2nd crop

			// image-box is the id of the div element that will store our cropping image preview
			const imagebox2 = document.getElementById('image-box')
			// crop-btn is the id of button that will trigger the event of change original file with cropped file.
			const crop_btn2 = document.getElementById('crop-btn')
			// id_image is the id of the input tag where we will upload the image
			const input2 = document.getElementById('img2')

			var allowedExtensions =
				/(\.jpg|\.jpeg|\.png|\.gif|\.webp)$/i;

			var filePath2 = input2.value;

			// When user uploads the image this event will get triggered
			input2.addEventListener('change', () => {
				if (!allowedExtensions.exec(input2.value)) {
					alert('Invalid file type');
					input2.value = '';
				}
				else {
					// Getting image file object from the input variable
					const img_data2 = input2.files[0]
					// createObjectURL() static method creates a DOMString containing a URL representing the object given in the parameter.
					// The new object URL represents the specified File object or Blob object.
					const url2 = URL.createObjectURL(img_data2)

					// Creating a image tag inside imagebox which will hold the cropping view image(uploaded file) to it using the url created before.
					imagebox2.innerHTML = `<img src="${url2}" id="image" style="width:100%;">`

					// Storing that cropping view image in a variable
					const image2 = document.getElementById('image')

					// Displaying the image box
					document.getElementById('image-box').style.display = 'block'
					// Displaying the Crop buttton
					document.getElementById('crop-btn').style.display = 'block'
					// Hiding the Post button
					document.getElementById('confirm-btn').style.display = 'none'

					// Creating a croper object with the cropping view image
					// The new Cropper() method will do all the magic and diplay the cropping view and adding cropping functionality on the website
					// For more settings, check out their official documentation at https://github.com/fengyuanchen/cropperjs
					const cropper2 = new Cropper(image2, {
						autoCropArea: 1,
						viewMode: 1,
						scalable: false,
						zoomable: false,
						movable: false,
						aspectRatio: 25 / 25,
						//preview: '.preview',
						minCropBoxWidth: 200,
						minCropBoxHeight: 200,
					})

					// When crop button is clicked this event will get triggered
					crop_btn2.addEventListener('click', () => {
						// This method coverts the selected cropped image on the cropper canvas into a blob object
						cropper2.getCroppedCanvas().toBlob((blob) => {

							// Gets the original image data
							let fileInputElement2 = document.getElementById('img2');
							// Make a new cropped image file using that blob object, image_data.name will make the new file name same as original image
							let file2 = new File([blob], img_data2.name, { type: "image/*", lastModified: new Date().getTime() });
							// Create a new container
							let container2 = new DataTransfer();
							// Add the cropped image file to the container
							container2.items.add(file2);
							// Replace the original image file with the new cropped image file
							fileInputElement2.files = container2.files;
							let img = container2.files[0]
							const url = URL.createObjectURL(img)
							document.getElementById('image2').src = url

							// Hide the cropper box
							document.getElementById('image-box').style.display = 'none'
							// Hide the crop button
							document.getElementById('crop-btn').style.display = 'none'
							// Display the Post button
							document.getElementById('confirm-btn').style.display = 'block'

						});
					});
				}
			});
			// 3rd crop

			// image-box is the id of the div element that will store our cropping image preview
			const imagebox3 = document.getElementById('image-box')
			// crop-btn is the id of button that will trigger the event of change original file with cropped file.
			const crop_btn3 = document.getElementById('crop-btn')
			// id_image is the id of the input tag where we will upload the image
			const input3 = document.getElementById('img3')

			var allowedExtensions =
				/(\.jpg|\.jpeg|\.png|\.gif|\.webp)$/i;

			var filePath3 = input3.value;

			// When user uploads the image this event will get triggered
			input3.addEventListener('change', () => {
				if (!allowedExtensions.exec(input3.value)) {
					alert('Invalid file type');
					input3.value = '';
				}
				else {
					// Getting image file object from the input variable
					const img_data3 = input3.files[0]
					// createObjectURL() static method creates a DOMString containing a URL representing the object given in the parameter.
					// The new object URL represents the specified File object or Blob object.
					const url3 = URL.createObjectURL(img_data3)

					// Creating a image tag inside imagebox which will hold the cropping view image(uploaded file) to it using the url created before.
					imagebox3.innerHTML = `<img src="${url3}" id="image" style="width:100%;">`

					// Storing that cropping view image in a variable
					const image3 = document.getElementById('image')

					// Displaying the image box
					document.getElementById('image-box').style.display = 'block'
					// Displaying the Crop buttton
					document.getElementById('crop-btn').style.display = 'block'
					// Hiding the Post button
					document.getElementById('confirm-btn').style.display = 'none'

					// Creating a croper object with the cropping view image
					// The new Cropper() method will do all the magic and diplay the cropping view and adding cropping functionality on the website
					// For more settings, check out their official documentation at https://github.com/fengyuanchen/cropperjs
					const cropper3 = new Cropper(image3, {
						autoCropArea: 1,
						viewMode: 1,
						scalable: false,
						zoomable: false,
						movable: false,
						aspectRatio: 25 / 25,
						//preview: '.preview',
						minCropBoxWidth: 200,
						minCropBoxHeight: 200,
					})

					// When crop button is clicked this event will get triggered
					crop_btn3.addEventListener('click', () => {
						// This method coverts the selected cropped image on the cropper canvas into a blob object
						cropper3.getCroppedCanvas().toBlob((blob) => {

							// Gets the original image data
							let fileInputElement3 = document.getElementById('img3');
							// Make a new cropped image file using that blob object, image_data.name will make the new file name same as original image
							let file3 = new File([blob], img_data3.name, { type: "image/*", lastModified: new Date().getTime() });
							// Create a new container
							let container3 = new DataTransfer();
							// Add the cropped image file to the container
							container3.items.add(file3);
							// Replace the original image file with the new cropped image file
							fileInputElement3.files = container3.files;
							console.log(container3.files[0])
							let img = container3.files[0]
							const url = URL.createObjectURL(img)
							document.getElementById('image3').src = url

							// Hide the cropper box
							document.getElementById('image-box').style.display = 'none'
							// Hide the crop button
							document.getElementById('crop-btn').style.display = 'none'
							// Display the Post button
							document.getElementById('confirm-btn').style.display = 'block'

						});
					});
				}
			});
		</script>



		<script>
			document.forms[1].setAttribute("enctype", "multipart/form-data")
		</script>
		</script>




	</div>
</div>
</div>
<!-- Input Validation End -->
</div>
</div>
<!-- js -->
<script src="{% static 'adm/vendors/scripts/core.js' %}"></script>
<script src="{% static 'adm/vendors/scripts/script.min.js' %}"></script>
<script src="{% static 'adm/vendors/scripts/process.js' %}"></script>
<script src="{% static 'adm/vendors/scripts/layout-settings.js' %}"></script>
<!-- <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script> -->
<script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/jquery.validate.js"></script>
<script>
	$(document).ready(function () {
		jQuery.validator.addMethod("noSpace", function (value, element) {
			return value == '' || value.trim(' ').length >= 4;
		}, "At leest four charecters");
		$("#submit-form").validate({
			rules: {
				brand: {
					required: true,
					minlength: 3
				},
				prodectname: {
					required: true,
					minlength: 3
				},
				model_no: {
					required: true,
					minlength: 3
				},
				gender: {
					required: true,
				},
				catagory: {
					required: true,
				},
				price: {
					required: true,
				},
				stock: {
					required: true,
				},
				discription: {
					required: true,
					minlength: 13
				},
				img1: {
					required: true,
				},
				img2: {
					required: true,
				},
				img3: {
					required: true,
				},
			}
		})
	});
</script>
</body>

</html>
{% endblock %}