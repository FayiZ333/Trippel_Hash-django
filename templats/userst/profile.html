{% load static %}
<!DOCTYPE html>
<html>

<head>
	<!-- Basic Page Info -->
	<meta charset="utf-8">
	<title>profile</title>

	<!-- Site favicon -->

	<!-- Mobile Specific Metas -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<!-- Google Font -->
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
		rel="stylesheet">


	<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

	<!-- CSS -->
	<link rel="stylesheet" type="text/css" href="{% static 'adm/vendors/styles/core.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'adm/vendors/styles/icon-font.min.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'adm/src/plugins/cropperjs/dist/cropper.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'adm/vendors/styles/style.css' %}">

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-119386393-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag() { dataLayer.push(arguments); }
		gtag('js', new Date());

		gtag('config', 'UA-119386393-1');
	</script>
</head>

<body>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.11/cropper.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.11/cropper.js"></script>
	
	<div class="pd-ltr-20 xs-pd-20-10">
		<div class="min-height-200px">
			<div class="page-header">
				<div class="row">
					<div class="col-md-12 col-sm-12">
						<div class="title">
							<h4>Profile</h4>
						</div>
						<nav aria-label="breadcrumb" role="navigation">
							<ol class="breadcrumb">
								<li class="breadcrumb-item"><a href="{% url 'hom' %}">Home</a></li>
								<li class="breadcrumb-item active" aria-current="page">Profile</li>
							</ol>
						</nav>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 mb-30">
					<div class="pd-20 card-box height-100-p">
						<div class="profile-photo">



								<!-- Modal Start -->
								<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog"
								aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
									<div class="modal-dialog modal-dialog-centered" role="document">
										<div class="modal-content">
											<div class="modal-header">
												<h5 class="modal-title" id="exampleModalLongTitle">Crop</h5>
												<button type="button" class="close" data-dismiss="modal" aria-label="Close">
													<span aria-hidden="true">&times;</span>
												</button>
											</div>
											<div class="modal-body">
												<div id="image-box" class="image-container"></div>
												<button class="btn btn-outline-info" id="crop-btn"
													style="width: 100%; margin-top: 10px; display: none; margin-bottom: 3%;"
													type="button">Crop</button>
												<div class="text-center">
													<img src="" id="image1">
												</div>
											</div>
											<div class="modal-footer">
												<button type="submit" class="btn btn-outline-primary" style="width: 100%;"
													data-dismiss="modal">OK</button>
											</div>
										</div>
									</div>
								</div>
							<!-- End Modal -->
							<!-- </form> -->
							<!-- <a href="modal" data-toggle="modal" data-target="#modal" class="edit-avatar"><i class="fa fa-pencil"></i></a> -->
							<img src="{% static 'adm/vendors/images/user.png' %}" class="border-radius-100 shadow" alt="">

						</div>

						<h5 class="text-center h5 mb-0">{{user.username}}</h5>
						{% if user.is_superuser %}
						<p class="text-center text-muted font-14">Admin</p>
						{% else %}
						<p class="text-center text-muted font-14">User</p>
						{% endif %}
						<div class="profile-info">
							<h5 class="mb-20 h5 text-blue">Contact Information</h5>
							<ul>
								<li>
									<span>Email Address:</span>
									{{user.email}}
								</li>
								<li>
									<span>Phone Number:</span>
									{{user.phone}}
								</li>
								<li>
									<span>Country:</span>
									{{user.country}}
								</li>
							</ul>
						</div>
					</div>
				</div>
				<div class="col-xl-8 col-lg-8 col-md-8 col-sm-12 mb-30">
					<div class="card-box height-100-p overflow-hidden">
						<div class="profile-tab height-100-p">
							<div class="tab height-100-p">
								<ul class="nav nav-tabs customtab" role="tablist">
									<li class="nav-item">
										<a class="nav-link active" data-toggle="tab" href="#user_info" role="tab">User
											Info</a>
									</li>
									<li class="nav-item">
										<a class="nav-link" data-toggle="tab" href="#edit_user" role="tab">Edit Info</a>
									</li>
									<li class="nav-item">
										<a class="nav-link" data-toggle="tab" href="#my_oredr" role="tab">My Order</a>
									</li>

								</ul>
								<div class="tab-content">
									<!-- Timeline Tab start -->
									<div class="tab-pane fade show active" id="user_info" role="tabpanel">
										<div class="pd-20">
											<ul class="profile-edit-list row">
												<li class="weight-500 col-md-12">
													<h4 class="text-blue h5 mb-20">Personal Information</h4>
													<div class="form-group">
														<label>User Name : {{ user.username }}</label>
													</div>
													<div class="form-group">
														<label>Email : {{user.email}}</label>
													</div>
													<div class="form-group">
														<label>Gender : {{ user.gender }}</label>
													</div>
													<div class="form-group">
														<label>Phone Number : {{ user.phone }}</label>
													</div>
													<div class="form-group">
														<label>Country : {{ user.country }}</label>
													</div>
													<div class="form-group">
														<label>State : {{ user.state }}</label>
													</div>
													<div class="form-group">
														<label>District : {{ user.district }}</label>
													</div>
													<div class="form-group">
														<label>Address : {{ user.address }}</label>
													</div>
												</li>

											</ul>
											<article class="card" style="width: 100%;">
												<header class="card-header mb-2">
													<strong class="d-inline-block mr-3">My Addresses</strong>
												</header>
												<div class="row">
													{% if addresses %}
													{% for address in addresses %}

													<div class="col-sm-6 mt-2 mb-2">
														<div class="card">

															<div class="card-body" style="height: 200px;">
																<div class="row">
																	<div class="col-md-8">
																		<h5 class="card-title mb-0">
																			{{address.full_name}}</h5>
																	</div>
																	<div class="col-md-4"
																		style="display: flex; justify-content:end">
																		<div class="dropdown">
																			<a class="btn btn-link font-24 p-0 line-height-1 no-arrow dropdown-toggle" href="#" role="button" data-toggle="dropdown">
																				<i class="dw dw-more"></i>
																			</a>
																			<div class="dropdown-menu dropdown-menu-right dropdown-menu-icon-list">
																				<a class="dropdown-item" href="{% url 'address_edit' address.id %}"><i class="dw dw-edit2"></i> Edit</a>
																				<a class="dropdown-item" href="{% url 'address_delete' address.id %}"  onclick="del_address(event)" style="color: red;"><i class="dw dw-delete-3"></i> Delete</a>
																			</div>
																		</div>
																	</div>
																</div>
																<p class="card-text mb-0">Address:</p>
																<p class="card-text mb-0">{{address.adrs}}</p>
																<p class="card-text mb-0">{{address.city}},
																	{{address.district}}, {{address.state}}</p>
																<p class="card-text mb-0">
																	{{address.country}},({{address.pincode}})</p>
																<p class="card-text mb-0">Phone:
																	{{address.phone}},{{address.phone2}}</p>
																<p class="card-text mb-0">Email: {{address.email}}</p>

															</div>
														</div>
													</div>
													{% endfor %}
													{% else %}
													<p class="pb-2" style="padding-left: 30px;">No saved addresses</p>
													{% endif %}
												</div>
											</article>
											<div class="form-group mb-0">
												<a class="nav-link btn btn-outline-primary" data-toggle="tab" href="#adrs" role="tab">Add Address</a>
											</div>
										</div>
									</div>
									<!-- Timeline Tab End -->

									<!-- Setting Tab start -->
									<div class="tab-pane fade height-100-p" id="edit_user" role="tabpanel">
										<div class="profile-setting">
											<form action="{% url 'edit_profile' %}" id="submit-form" method="POST">
												{% csrf_token %}
												<ul class="profile-edit-list row">
													<li class="weight-500 col-md-12">
														<h4 class="text-blue h5 mb-20">Edit Your Personal Information
														</h4>
														<div class="form-group">
															<label>User Name</label>
															<input name="username" id="username" value="{{ user.username }}"
																class="form-control form-control-lg" type="text">
														</div>
														<div class="form-group">
															<label>Email</label>
															<input name="email" id="email" value="{{ user.email }}"
																class="form-control form-control-lg" type="email">
														</div>
														<div class="form-group">
															<label>Gender</label>
															
															{% if user.gender == 'Female' %}
															<div class="d-flex">
																<div class="custom-control custom-radio mb-5 mr-20">
																	<input type="radio" id="customRadio4" name="gender"
																		value="Male" class="custom-control-input">
																	<label class="custom-control-label weight-400"
																		for="customRadio4">Male</label>
																</div>
																<div class="custom-control custom-radio mb-5">
																	<input type="radio" id="customRadio5" checked
																		name="gender" value="Female"
																		class="custom-control-input">
																	<label class="custom-control-label weight-400"
																		for="customRadio5">Female</label>
																</div>
															</div>
															{% else %}
															<div class="d-flex">
																<div class="custom-control custom-radio mb-5 mr-20">
																	<input type="radio" id="customRadio4" name="gender" checked
																		value="Male" class="custom-control-input">
																	<label class="custom-control-label weight-400"
																		for="customRadio4">Male</label>
																</div>
																<div class="custom-control custom-radio mb-5">
																	<input type="radio" id="customRadio5" name="gender"
																		value="Female" class="custom-control-input">
																	<label class="custom-control-label weight-400"
																		for="customRadio5">Female</label>
																</div>
															</div>
															{% endif %}

														</div>
														<div class="form-group">
															<label>Phone Number</label>
															<input name="phone" id="phone" value="{{ user.phone }}"
																class="form-control form-control-lg" type="number">
														</div>
														<div class="form-group">
															<label>Country</label>
															<select class="selectpicker form-control form-control-lg"
																data-style="btn-outline-secondary btn-lg"
																name="country" id="country">
																<option value="{{ user.country }}">{{ user.country }}
																</option>
																{% if user.country != 'US' %}
																<option value="US">United States</option>
																{% endif %}
																{% if user.country != 'India' %}
																<option value="India">India</option>
																{% endif %}
																{% if user.country != 'UK' %}
																<option value="UK">United Kingdom</option>
																{% endif %}
															</select>
														</div>
														<div class="form-group">
															<label>State</label>
															<input name="state" id="state" value="{{ user.state }}"
																class="form-control form-control-lg" type="text">
														</div>
														<div class="form-group">
															<label>District</label>
															<input name="district" id="district" value="{{ user.district }}"
																class="form-control form-control-lg" type="text">
														</div>
														<div class="form-group">
															<label>Address</label>
															<textarea name="address" id="address" value="{{ user.address }}"
																class="form-control">{{ user.address }}</textarea>
														</div>
														<div class="form-group">
															<label>Image</label>
															<input class="form-control" placeholder="image" name="profile_img" id="img1" class="form-control form-control-lg"
																accept="image/*" data-toggle="modal" data-target="#exampleModalCenter" type="file">
														</div>
														<div class="form-group">
															<label class="btn btn-outline-info"data-toggle="modal" data-target="#exampleModalCenter">Preview</label>
														</div>
														<div class="form-group mb-0">
															<input type="submit" class="btn btn-primary" 
																value="Update Information">
														</div>
													</li>

												</ul>
											</form>
										</div>
									</div>
									<div class="tab-pane fade height-100-p" id="my_oredr" role="tabpanel">
										<div class="profile-setting">
											<div class="table-responsive">
												<table class="table nowrap">
													<thead>
														<tr>
															<th class="table-plus datatable-nosort">No.</th>
															<th>Product Name</th>
															<th>Brand</th>
															<th>Quantity</th>
															<th>Status</th>
															<th>Date</th>
															<th></th>
														</tr>
													</thead>
													<tbody>
															{% for order_prodect in order_prodects %}
															<tr>
																<td class="table-plus">{{ forloop.counter }}</td>
																<td>{{order_prodect.prodect.brand}}</td>

																<td>{{order_prodect.prodect.brand}}</td>

																<td>{{order_prodect.quantity}}</td>


																{% if order_prodect.status == 'Placed' %}
																<td style="color: rgb(0, 110, 255);">
																	{{order_prodect.status}}</td>
																{% elif order_prodect.status == 'Shipping' %}
																<td style="color: rgb(255, 196, 0);">
																	{{order_prodect.status}}</td>
																{% elif order_prodect.status == 'Deliverd' %}
																<td style="color: rgb(9, 255, 0);">{{order_prodect.status}}
																</td>
																{% elif order_prodect.status == 'Cancelled' %}
																<td style="color: red;">{{order_prodect.status}}</td>
																{% elif order_prodect.status == 'Return' %}
																<td style="color: rgb(35, 35, 37);">{{order_prodect.status}}
																</td>
																{% endif %}





																<td>{{order_prodect.created_at}}</td>

																<td class="table-plus">
																	<div class="name-avatar d-flex align-items-center">
																		<div class="avatar mr-2 flex-shrink-0">
																			<img src="{{ order_prodect.prodect.img1.url }}"
																				class="border-radius-100 shadow"
																				width="65px" height="65px" alt="">
																		</div>
																	</div>
																</td>
																{% if order_prodect.status == "Deliverd" %}
																<td>
																	<div class="dropdown">
																		<a class="btn btn-link font-24 p-0 line-height-1 no-arrow dropdown-toggle"
																			href="#" role="button" data-toggle="dropdown">
																			<i class="dw dw-more"></i>
																		</a>
																		<div
																			class="dropdown-menu dropdown-menu-right dropdown-menu-icon-list">
																			<a class="dropdown-item"
																				href="{% url 'order_return' order_prodect.id %}" onclick="del_return(event)"><i
																					class="dw dw-delete-3"></i> Return</a>
																		</div>
																	</div>
																</td>
																{% elif order_prodect.status != "Cancelled" and order_prodect.status != "Return" %}
																<td>
																	<div class="dropdown">
																		<a class="btn btn-link font-24 p-0 line-height-1 no-arrow dropdown-toggle"
																			href="#" role="button" data-toggle="dropdown">
																			<i class="dw dw-more"></i>
																		</a>
																		<div
																			class="dropdown-menu dropdown-menu-right dropdown-menu-icon-list">
																			<a class="dropdown-item"
																				href="{% url 'order_cancel' order_prodect.id %}" onclick="del_cancel(event)"><i
																					class="dw dw-edit2"></i> Cancel</a>
																		</div>
																	</div>
																</td>
																{% endif %}

															</tr>
															{% endfor %}
													</tbody>
												</table>
											</div>
										</div>
									</div>
									
									<div class="tab-pane fade height-100-p" id="adrs" role="tabpanel">
										<div class="profile-setting">
											<article class="card mt-3">
												<header class="card-header mb-2">
													<strong class="d-inline-block mr-3">Add Address</strong>
												</header>
												<div class="col-md-12">
													<form action="" method="post">
														{% csrf_token %}

														<div class="form-row mt-3">
															<div class="form-group col-md-3">
																<label>First Name</label>
																{{ address_form.first_name }}
															</div>
															<div class="form-group col-md-3">
																</div>
															<div class="form-group col-md-3">
																<label>Last Picture</label>
																{{ address_form.last_name }}
															</div>
														</div>
														<div class="form-group col-md-3">
															</div>
														<div class="form-row mt-3">
															<div class="form-group col-md-3">
																<label>Phone NO</label>
																{{ address_form.phone }}
															</div>
															<div class="form-group col-md-3">
																</div>
															<div class="form-group col-md-3">
																<label>Phone NO 2</label>
																{{ address_form.phone2 }}
															</div>
														</div>
														<div class="form-group col-md-3">
															</div>
														<div class="form-row">
															<div class="form-group col-md-3">
																<label>Address</label>
																{{ address_form.adrs }}
															</div>
															<div class="form-group col-md-3">
																</div>
															<div class="form-group col-md-3">
																<label>Email</label>
																{{ address_form.email }}
															</div>
														</div>
														<div class="form-group col-md-3">
															</div>

														<div class="form-row">
															<div class="form-group col-md-3">
																<label>City</label>
																{{ address_form.city }}
															</div>
															<div class="form-group col-md-3">
																<label>District</label>
																{{ address_form.district }}
															</div>
															<div class="form-group col-md-3">
																<label>State</label>
																{{ address_form.state }}
															</div>
															<div class="form-group col-md-3">
																<label>Country</label>
																{{ address_form.country }}
															</div>
															<div class="form-group col-md-3">
																<label>Pincode</label>
																{{ address_form.pincode }}
															</div>
														</div>

														<div class="row">
															<div class="col-md-6"
																style="display: flex; justify-content: left; padding-bottom: 1%;">
																<a href="{% url 'profile' %}"
																	class="btn btn-outline-danger">Cancel</a>
															</div>
															<div class="col-md-6"
																style="display: flex; justify-content: end; padding-bottom: 1%;">
																<input type="submit" class="btn btn-outline-primary">
															</div>
														</div>

													</form>
												</div>

											</article>
										</div>
									</div>
									<!-- Setting Tab End -->
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- <div class="footer-wrap pd-20 mb-20 card-box">
			######################
		</div> -->
	</div>

	<!-- modal -->
	<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
    aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLongTitle">Crop</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div id="image-box" class="image-container"></div>
					<button class="btn btn-outline-info" id="crop-btn"
						style="width: 100%; margin-top: 10px; display: none; margin-bottom: 3%;" type="button">Crop</button>
						<div class="text-center">
						<img src="" id="image1">
						</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-outline-primary" style="width: 100%;" data-dismiss="modal">OK</button>
				</div>
			</div>
		</div>
	</div>
	<!-- end_modal -->
	<!-- js -->
	<script src="{% static 'adm/vendors/scripts/core.js' %}"></script>
	<script src="{% static 'adm/vendors/scripts/script.min.js' %}"></script>
	<script src="{% static 'adm/vendors/scripts/process.js' %}"></script>
	<script src="{% static 'adm/vendors/scripts/layout-settings.js' %}"></script>
	<script src="{% static 'adm/src/plugins/cropperjs/dist/cropper.js' %}"></script>
	<script>
		$(document).ready(function () {
			jQuery.validator.addMethod("noSpace", function (value, element) {
				return value == '' || value.trim(' ').length >= 4;
			}, "At leest four charecters");
			$("#submit-form").validate({
				rules: {
					username: {
						required: true,
						minlength: 3
					},
					email: {
						required: true,
						minlength: 3
					},
					phone: {
						required: true,
						minlength: 10,
						maxlength: 10,
					},
					country: {
						required: true,
						minlength: 3
					},
					state: {
						required: true,
						minlength: 3
					},
					district: {
						required: true,
						minlength: 3
					},
					address: {
						required: true,
						minlength: 3
					},
				}
			})
		});
	</script>
	<script>

		//1st crop
	
		// image-box is the id of the div element that will store our cropping image preview
		const imagebox = document.getElementById('image-box')
		// crop-btn is the id of button that will trigger the event of change original file with cropped file.
		const crop_btn = document.getElementById('crop-btn')
		// id_image is the id of the input tag where we will upload the image
		const input = document.getElementById('img1')
		var allowedExtensions =
			/(\.jpg|\.jpeg|\.png|\.webp)$/i;
	
		var filePath = input.value;
	
		// When user uploads the image this event will get triggered
		input.addEventListener('change', () => {
			if (!allowedExtensions.exec(input.value)) {
				alert('Invalid file type');
				input.value = '';
			}
			else {
				// Getting image file object from the input variable
				const img_data = input.files[0]
				// createObjectURL() static method creates a DOMString containing a URL representing the object given in the parameter.
				// The new object URL represents the specified File object or Blob object.
				const url = URL.createObjectURL(img_data)
	
				// Creating a image tag inside imagebox which will hold the cropping view image(uploaded file) to it using the url created before.
				imagebox.innerHTML = `<img src="${url}" id="image" style="width:500px;">`
	
				// Storing that cropping view image in a variable
				const image = document.getElementById('image')
	
				// Displaying the image box
				document.getElementById('image-box').style.display = 'block'
				// Displaying the Crop buttton
				document.getElementById('crop-btn').style.display = 'block'
				// Hiding the Post button
				// document.getElementById('confirm-btn').style.display = 'none'
	
				// Creating a croper object with the cropping view image
				// The new Cropper() method will do all the magic and diplay the cropping view and adding cropping functionality on the website
				// For more settings, check out their official documentation at https://github.com/fengyuanchen/cropperjs
				const cropper = new Cropper(image, {
					autoCropArea: 1,
					viewMode: 1,
					scalable: false,
					zoomable: false,
					movable: false,
					aspectRatio: 25 / 25,
					//preview: '.preview',
					minCropBoxWidth: 200,
					minCropBoxHeight: 200,
				})
	
				// When crop button is clicked this event will get triggered
				crop_btn.addEventListener('click', () => {
					// This method coverts the selected cropped image on the cropper canvas into a blob object
					cropper.getCroppedCanvas().toBlob((blob) => {
	
						// Gets the original image data
						let fileInputElement = document.getElementById('img1');
						// Make a new cropped image file using that blob object, image_data.name will make the new file name same as original image
						let file = new File([blob], img_data.name, { type: "image/*", lastModified: new Date().getTime() });
						// Create a new container
						let container = new DataTransfer();
						// Add the cropped image file to the container
						container.items.add(file);
						// Replace the original image file with the new cropped image file
						fileInputElement.files = container.files;
						console.log(container.files[0])
						let img = container.files[0]
						const url = URL.createObjectURL(img)
						document.getElementById('image1').src = url
	
						// Hide the cropper box
						document.getElementById('image-box').style.display = 'none'
						// Hide the crop button
						document.getElementById('crop-btn').style.display = 'none'
						// Display the Post button
						document.getElementById('confirm-btn').style.display = 'block'
	
					});
	
				});
			}
		});
	</script>
	<script>
		function del_address(event){
			event.preventDefault();
			console.log(event.target.href);
			var link=event.target.href;
			
			swal({
				title: "Are you sure?",
				text: "Do you want to delete this Address",
				icon: "warning",
				buttons: true,
				dangerMode: true,
				})
				.then((willDelete) => {
				if (willDelete) {
					window.location = link;
				} else {
				}
			});
		}
		
	</script>
	<script>
		function del_cancel(event){
			event.preventDefault();
			console.log(event.target.href);
			var link=event.target.href;
			
			swal({
				title: "Are you sure?",
				text: "Do you want to cancel this order",
				icon: "warning",
				buttons: true,
				dangerMode: true,
				})
				.then((willDelete) => {
				if (willDelete) {
					window.location = link;
				} else {
				}
			});
		}
		
	</script>
	<script>
		function del_return(event){
			event.preventDefault();
			console.log(event.target.href);
			var link=event.target.href;
			
			swal({
				title: "Are you sure?",
				text: "Do you want to return this order",
				icon: "warning",
				buttons: true,
				dangerMode: true,
				})
				.then((willDelete) => {
				if (willDelete) {
					window.location = link;
				} else {
				}
			});
		}
		
	</script>
</body>

</html>